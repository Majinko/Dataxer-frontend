<div class="row my-3 justify-content-start" *ngIf="years">
    <div class="col-md-4 col-lg-2">
        <ng-select [items]="years" [clearable]="false" [(ngModel)]="year" (ngModelChange)="getData()" placeholder="Rok"
            class="filter-ng-select">
            <ng-template ng-option-tmp let-item="item" let-search="searchTerm">
                <div><span>{{item}}</span></div>
            </ng-template>
        </ng-select>
    </div>
</div>

<div class="row" *ngIf="isLoadAdditionalData; else loading">
    <div class="col-md-4">
        <div>
            <p class="mb-0">Celkový počet hodín:</p>
            <h3 class="text-dark"><b>{{additionalData.totalTime || '-'}} h</b></h3>
        </div>
        <div>
            <p class="mb-0">Počet a suma aktívnych hodín (na zákazkách):</p>
            <h3 class="text-dark"><b>{{additionalData.totalActiveTime || '-'}} h</b></h3>
        </div>
        <div>
            <p class="mb-0">Počet a suma neaktivnych hodín (na zákazkách):</p>
            <h3 class="text-dark"><b>{{additionalData.totalNonActiveTime || '-'}} h</b></h3>
        </div>
        <div>
            <p class="mb-0">Počet a suma firemných hodín:</p>
            <h3 class="text-dark"><b>{{additionalData.totalTimeInCompanyProject || '-'}} h</b></h3>
        </div>
    </div>
    <div class="col-md-4">
        <div>
            <p class="mb-0">Celková bilancia nákladov: <mat-icon class="mat-16" style="vertical-align: sub;" matTooltip="Celková bilancia nákladov, ktoré počítajú náklad k hodinovke (súčet všetkých nákladov + hodín)">help</mat-icon></p>
            <h3 class="text-dark"><b>{{(additionalData.totalTime |
                    currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
        <div>
            <p class="mb-0">Celková bilancia firma:</p>
            <h3 class="text-dark"><b>{{(additionalData.totalTime |
                    currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
        <div>
            <p class="mb-0">Celková bilancia firemné zákazky:</p>
            <h3 class="text-dark"><b>{{(additionalData.totalTime |
                    currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
    </div>
    <div class="col-md-4">
        <div>
            <p class="mb-0">Celkove príjmy zákaziek:</p>
            <h3 class="text-dark"><b>{{(additionalData.totalIncomesFromProject |
                    currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
        <div>
            <p class="mb-0">Celkové výdaje zákaziek:</p>
            <h3 class="text-dark"><b>{{(additionalData.totalCostFromProject |
                    currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
        <div>
            <p class="mb-0">Celková bilancia zákaziek okrem hodín pre firmu:</p>
            <h3 class="text-dark"><b>{{(additionalData.totalBalanceForProject |
                currency:'EUR':'symbol') || '-'}}</b></h3>
        </div>
    </div>
</div>

<div *ngIf="!isLoad; else loading">
    <h2 class="border-bottom-2 pb-2 mb-4 mb-4">Prehľad financií</h2>
    <button class="mb-2" mat-button (click)="toggleAccord()">
        <ng-container *ngIf="!toogleAccord">
            <mat-icon>unfold_more</mat-icon>
            Zobraziť všetko
        </ng-container>
        <ng-container *ngIf="toogleAccord">
            <mat-icon>unfold_less</mat-icon>
            Skryť všetko
        </ng-container>
    </button>
    <mat-accordion [multi]="true">
        <mat-expansion-panel *ngFor="let item of reviewFinance">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <span class="mr-3">{{item.categoryGroup}}</span> <strong>{{item.totalPrice |
                        currency:'EUR':'symbol'}}</strong>
                </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-accordion #accord="matAccordion" [multi]="true" class="mb-2">
                <button mat-icon-button class="mb-2 accord-button" (click)="toggle(accord, item)">
                    <ng-container *ngIf="!item.showed">
                        <mat-icon>unfold_more</mat-icon>
                    </ng-container>
                    <ng-container *ngIf="item.showed">
                        <mat-icon>unfold_less</mat-icon>
                    </ng-container>
                </button>
                <mat-expansion-panel *ngFor="let data of item.categoryGroupDetailOverview" [expanded]="item.showed">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            <span class="mr-3">{{data.type}}</span> <strong>{{data.totalPrice |
                                currency:'EUR':'symbol'}}</strong>
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <app-overview-review-finance-table [data]="data.data"></app-overview-review-finance-table>
                </mat-expansion-panel>
            </mat-accordion>
        </mat-expansion-panel>
    </mat-accordion>
</div>

<ng-template #loading>
    <div class="w-100 d-flex justify-content-center mt-5 pt-5">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>